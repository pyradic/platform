{# @var \Pyro\Platform\Platform platform #}


{% if config('platform.webpack.enabled') and config('platform.webpack.active') %}
    <!--WEBPACK_HERE_PLEASE-->
{% else %}

    {{ asset_add('platform.js', 'platform::js/platform.js', [ 'webpack:pyro__platform:scripts' ]) }}

    {% for script in platform.renderScripts %}
        {{ asset_public_script(script) }}
    {% endfor %}

    {% for style in platform.publicStyles %}
        {{ asset_public_style(style) }}
    {% endfor %}

{% endif %}

<!-- DATA -->
<script>window['pyro'].data = JSON.parse('{{ platform.data.toJson | replace({"'": "\\'"}) | raw }}');</script>
<!-- CONFIG -->
<script>window['pyro'].config = JSON.parse('{{ platform.config.toJson | replace({"'": "\\'"}) | raw }}');</script>
<!-- PROVIDERS -->
<script>window['pyro'].providers = [{{ platform.providers }}];</script>

{% if platform.shouldntPreventBootstrap %}
    <script>
        (function () {
            var app = this.pyro.pyro__platform.Application.instance;
            var log = app.createLog('cp_scripts');

            app
                .bootstrap({
                    config   : pyro.config,
                    providers: pyro.providers,
                    data     : pyro.data
                })
                .then(function (app) {
                    return app.boot();
                })
                .then(function (app) {
                    app.extendRoot({
                        mounted   : function () {
                            $.holdReady(false);
                        }
                    });
                    app.start('#app');
                });
        }.call(window, window));
    </script>
{% endif %}