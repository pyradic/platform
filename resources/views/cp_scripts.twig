{# @var \Pyro\Platform\Platform platform #}
{{ asset_add('platform.js', 'platform::js/platform.js', [ 'webpack:pyro__platform:scripts' ]) }}

{% if config('platform.webpack.enabled') and config('platform.webpack.active') %}
    <!--WEBPACK_HERE_PLEASE-->
{% else %}


    {% for script in platform.renderScripts %}
        {{ asset_public_script(script) }}
    {% endfor %}
{#    {% for style in platform.publicStyles %}#}
{#        {{ asset_public_style(style) }}#}
{#    {% endfor %}#}
{% endif %}

<!-- PLATFORM_DATA -->
<script>
    {#var PLATFORM_DATA = JSON.parse('{{ platform.data.toJson(null,constant('JSON_HEX_APOS') b-and constant('JSON_HEX_QUOT')) | raw }}');#}
    var PLATFORM_DATA = JSON.parse('{{ platform.data.toJson | replace({"'": "\\'"}) | raw }}');
</script>

<!-- PLATFORM_CONFIG & PLATFORM_PROVIDERS -->
<script>
    var PLATFORM_CONFIG = JSON.parse('{{ platform.config.toJson | replace({"'": "\\'"})  | raw }}');
    var PLATFORM_PROVIDERS = [{{ platform.providers | join(', ') }}];
</script>

{{ asset_inline('platform_pre_boot') }}

{% if platform.shouldntPreventBootstrap %}
    <script>
        (function () {
            var app = this.pyro.pyro__platform.Application.instance;
            var log = app.createLog('cp_scripts');
            var install = pyro.pyro__platform.install;

            log({
                t                      : this,
                pyro,
                tpyro                  : this.pyro,
                pyro_platform          : pyro.pyro__platform,
                pyro_platform_provider : pyro.pyro__platform.PlatformServiceProvider,
                tpyro_platform_provider: this.pyro.pyro__platform.PlatformServiceProvider,
            });
            app
                .bootstrap({
                    providers: [
                        this.pyro.pyro__platform.PlatformServiceProvider
                    ]
                }, {
                    config   : PLATFORM_CONFIG,
                    providers: PLATFORM_PROVIDERS
                })
                .then(function (app) {
                    return app.boot();
                })
                .then(function (app) {
                    // Vue.use(pyro.platform.Plugin);
                    app.extendRoot({
                        mounted: function () {
                            $.holdReady(false);
                        }
                    });
                    app.start('#app');
                });
        }.call(window, window));
    </script>
{% endif %}