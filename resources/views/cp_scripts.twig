{# @var \Illuminate\Foundation\Application app #}
{# @var \Pyro\Platform\Platform platform #}
{# @var \Pyro\Webpack\Webpack webpack #}


{% if app.webpack.isEnabled() and app.webpack.isActive() %}
    <!--WEBPACK_HERE_PLEASE-->
{% else %}

    <!-- ASSETS HERE PLX -->
{#    {{ asset_add('platform.js', 'platform::js/platform.js', [ 'webpack:pyro__platform:scripts' ]) }}#}
    {{ app.webpack.renderScripts|raw }}
    {{ app.webpack.renderStyles|raw }}
{% endif %}

<!-- DATA -->
<script>window['pyro'].data = JSON.parse('{{ platform.data.toJson | replace({"'": "\\'"}) | raw }}');</script>
<!-- CONFIG -->
<script>window['pyro'].config = JSON.parse('{{ platform.config.toJson | replace({"'": "\\'"}) | raw }}');</script>
<!-- PROVIDERS -->
<script>window['pyro'].providers = [{{ platform.providers }}];</script>

{% if platform.shouldntPreventBootstrap %}
    <script>
        (function () {
            var app = this.pyro.pyro__platform.Application.instance;
            var log = app.createLog('cp_scripts');

            app
                .bootstrap({
                    config   : pyro.config,
                    providers: pyro.providers,
                    data     : pyro.data
                })
                .then(function (app) {
                    return app.boot();
                })
                .then(function (app) {
                    app.extendRoot({
                        mounted   : function () {
                            $.holdReady(false);
                        }
                    });
                    app.start('#app');
                });
        }.call(window, window));
    </script>
{% endif %}